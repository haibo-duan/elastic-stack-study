# Task 1
将a字段定义为nested,将原始idx索引reindex到新索引, 确认对 nested object查询的结果

数据准备:
```
PUT /order/_doc/1
{
  "order_name": "xiaomi order",
  "desc": "shouji zhong de zhandouji",
  "goods_count": 3,
  "total_price": 12699,
  "goods_list": [
    {
      "name": "xiaomi PRO MAX 5G",
      "price": 1999
    },
    {
      "name": "ganghuamo",
      "price": 19
    },
    {
      "name": "shoujike",
      "price": 1999
    }
  ]
}
PUT /order/_doc/2
{
  "order_name": "Cleaning robot order",
  "desc": "shouji zhong de zhandouji",
  "goods_count": 2,
  "total_price": 12699,
  "goods_list": [
    {
      "name": "xiaomi cleaning robot order",
      "price": 1999
    },
    {
      "name": "dishwasher",
      "price": 4999
    }
  ]
}

```
现在查询，goods_list.name 为xiaomi goods_list.price为4999 会查询到数据。现在需要将这个查询弄正确。
```
GET order/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "goods_list.name": "xiaomi"
          }
        },
        {
          "term": {
            "goods_list.price": {
              "value": 4999
            }
          }
        }
      ]
    }
  }
}
```

答案：
将数据reindex到 order_new 
```
DELETE order_new
# 1.修改mapping将类型改为nested
PUT order_new
{
  "mappings": {
    "properties": {
      "goods_list" : {
        "type": "nested"
      }
    }
  }
}

# 2.reindex索引
POST _reindex
{
  "source": {
    "index": "order"
  },
  "dest": {
    "index": "order_new"
  }
}

# 3.检索数据
GET order_new/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "goods_list.name": "xiaomi"
          }
        },
        {
          "term": {
            "goods_list.price": {
              "value": 4999
            }
          }
        }
      ]
    }
  }
}
```

# Task 2
现有索引index_synonym，用oa、OA、oA match查询是3条，使用dingding的match查询是2条。
- 要求

- 使用_reindex创建新的索引到index_synonyms_reindex
使用oa、OA、0A、oA、dingding都是6条
- 考点

自定义分词器
同义词
reindex
文档

- 数据
```
PUT index_synonym/_bulk
{"index":{"_id":1}}
{"title":"oa is very good"}
{"index":{"_id":2}}
{"title":"oA is very good"}
{"index":{"_id":3}}
{"title":"OA is very good"}
{"index":{"_id":4}}
{"title":"dingding is very good"}
{"index":{"_id":5}}
{"title":"dingding is ali software"}
{"index":{"_id":6}}
{"title":"0A is very good"}
PUT index_synonym/_bulk
{"index":{"_id":1}}
{"title":"oa is very good"}
{"index":{"_id":2}}
{"title":"oA is very good"}
{"index":{"_id":3}}
{"title":"OA is very good"}
{"index":{"_id":4}}
{"title":"dingding is very good"}
{"index":{"_id":5}}
{"title":"dingding is ali software"}
{"index":{"_id":6}}
{"title":"0A is very good"}
```

答案
```
# 1.自定义分词器 + mapping  定义在字段级

PUT index_synonym_reindex
{
  "settings": {
    "analysis": {
      "analyzer": {
        "my_analyzer": {
          "type": "custom",
          "tokenizer": "whitespace",
          "filter": [
            "my_synonym"
          ]
        }
      },
      "filter": {
        "my_synonym": {
          "type": "synonym",
          "synonyms": [
            "oa,OA,Oa,oA,0a,dingding"
          ]
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "my_analyzer"
      }
    }
  }
}

#2. reindex数据
POST _reindex
{
  "source": {
    "index": "index_synonym"
  },
  "dest": {
    "index": "index_synonyms_reindex"
  }
}

#3.查询
GET index_synonym_reindex/_search
{
  "query": {
    "match": {
      "title": "0a"
    }
  }
}

```

